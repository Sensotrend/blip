
<!DOCTYPE html>
<html lang='en'>
	<head>
		<meta charset='utf-8'>
		<meta content='width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=0' name='viewport' />
		<!--<meta name="viewport" content="width=1200px" />-->

		<script src="/js/jquery.js"></script>
		<script src="/js/d3.js"></script>
		<script src="/js/underscore.js"></script>
		<script src="/js/tipsy.js"></script>
		<script src="/js/moment.js"></script>
	  <script src='/js/jquery-ui-1.10.3.custom.min.js'></script>
	  <script src='/js/raphael.js'></script>
	  <script src='/js/pie.js'></script>

		<script src="/json/bg.json"></script>
		<script src="/json/cgm.json"></script>
		<script src="/json/pump-settings.json"></script>
		<script src="/json/pump-adherence.json"></script>
		<script src="/json/pump-insulin.json"></script>
		<script src="/json/pump-events.json"></script>

		<script src="/js/widget.js"></script>
		<script src="/js/helpers.js"></script>
		<script src="/js/day.js"></script>
		<script src="/js/timeline.js"></script>
		<script src="/js/stats.js"></script>

		<link href="/css/tipsy.css" rel="stylesheet" type="text/css" />
		<link href="/css/reset.css" rel="stylesheet" type="text/css" />
		<link href="/css/index.css" rel="stylesheet" type="text/css" />
<script>
var increment = 14;
count = 0;
var isTimeline = false;
window.scrollTo(0,0);
var currentView = 'day';

$('body').addClass('stop-scrolling');

$(window).bind("load", function() {
	var speed = 10;

	$('body').addClass('stop-scrolling');

	var toggle = true;
	$('#content').show();
	$(".ani-bg").animate({
		marginTop: '220px'
	}, speed);

	setTimeout(function() {
		$("#content").show();
		timeline.scroll();
	}, speed/2);			

	setTimeout(function() {
		$("#load").fadeOut(500, function() {
			$('body').removeClass('stop-scrolling');
		});
	}, speed);
});

$(function() {
	var first = true;

	var readings = [
				{value: 13, min:10, max: 50, ago: '2 months ago'},
				{value: 5, min:7, max: 30, ago: '5 months ago'},
				{value: 7, min:9, max: 40, ago: '8 months ago'}
			];

			hba1cWidget('hba1c-image', readings);

	$('#one').click(function() {

		$('.period li').css('font-weight', '100');
		$('#one').css('font-weight', 'bold');
		isTimeline = true;
		$('#chart').hide();
		$('#timelineHolder').show();

		timeline.scroll(bg[bg.length - 1].date, 0);
		first = false;
	});

	$('#week').click(function() {
		$('.period li').css('font-weight', '100');
		$('#week').css('font-weight', 'bold');

		$('#chart').show()
		$('#timelineHolder').hide();

		increment = 7;
	});

	$('#two').click(function() {
		isTimeline = false;
		$('.period li').css('font-weight', '100');
		$('#two').css('font-weight', 'bold');
		
		$('#chart').show()
		$('#timelineHolder').hide();

		increment = 14;
	});

	$('.today').click(function() {
		if(isTimeline) {
			timeline.scroll('today');
		} else {
			day.scroll('today');
		}
	});

	$('.arrowup').click(function() {
		if(isTimeline) {
			timeline.scroll(1);
		} else {
			day.scroll(14);
		}
	});

	$('.arrowdown').click(function() {
		if(isTimeline) {
			timeline.scroll(-1);
		} else {
			day.scroll(-14);
		}
	});			

	var time =  500;
	var up = false;
	$('#cover, .currentPatient img, .currentPatient h1').click(function() {
		if(!up) {
			$('.holder').slideDown(time);
			$(".currentPatient img").animate({
				width: '90px',
				left: '20px',
				top: '80px'
			},time);
			$(".currentPatient h1").animate({
				left: '113px',
				top: '4px'
			},time);	
			up = true;
		} else {
			$('.holder').slideUp(time);
			$(".currentPatient img").animate({
				width: '70px',
				left: '135px',
				top: '32px'
			},time);
			$(".currentPatient h1").animate({
				left: '210px',
				top: '-31px'
			},time);	
			up = false;
		}
		//$(".currentPatient").switchClass( "currentPatient", "currentPatient1",time);
	});

	bg.map(addDate);
	cgm.map(addDate);
	pumpInsulin.map(addDate);
	pumpAdherence.map(addDate);
	pumpEvents.map(addDate);

	timeline = drawTimeline();
	timeline.draw(bg, cgm, pumpSettings, pumpInsulin);

	day = drawDay();
	day.draw(bg, timeline);

	$('#one').trigger('click');
	day.scroll(bg[bg.length - 1].date);


	var stat = stats(bg, cgm, pumpInsulin);
	var aw = averageWidget('average-widget', 0, [50,180]);

  var values = [20, 80],
    labels = ['', ''],
    colors = ['white', '#009AA3'],
    bcolors = ['white', '#009AA3'];


  var rangePie = Raphael("range-widget", 54, 54).pieChart(27, 27, 25, values, labels, colors, bcolors, "#B6C6CF");

	$('#chartMain').scroll(function() {
		var average = stat.average(day.scrollTicks()-(14*oneDay), day.scrollTicks());

		if(average) {
			$('#averageData').text(average);
			aw.update(parseInt(average));
			$('#bg-stat').css('opacity', 1);
		} else {
			$('#bg-stat').css('opacity', 0.3);
		}
		
		var range = stat.range(day.scrollTicks()-(14*oneDay), day.scrollTicks());
		
		if(range) {
			$('#rangeData').text(range  + '%');
				var values = [100-range, range];
				if(range == 100) {
					values = [1, 99];
				}
    var labels = ['', ''],
    colors = ['white', '#84C5D9'],
    bcolors = ['white', '#84C5D9'];

    $("#range-widget").children().remove()
  var rangePie = Raphael("range-widget", 54, 54).pieChart(27, 27, 25, values, labels, colors, bcolors, "#B6C6CF");


			$('#range-stat').css('opacity', 1);
		} else {
			$('#range-stat').css('opacity', 0.3);
		}

		var insulinStats = stat.insulinRatio(day.scrollTicks()-(14*oneDay), day.scrollTicks());

		if(insulinStats && insulinStats.basalPercent > 0) {
			$('#insulinData').text(insulinStats.bolusPercent + '%:' + insulinStats.basalPercent + '%');

		var values = [insulinStats.bolusPercent, insulinStats.basalPercent],
      labels = [insulinStats.bolus, insulinStats.basal],
      colors = ['white', '#009AA3'],
      bcolors = ['#009AA3', '#87F4EF'];

    $("#bolus-widget").children().remove()
  	var rangePie = Raphael("bolus-widget", 54, 54).pieChart(27, 27, 25, values, labels, colors, bcolors, "#B6C6CF");

			$('#insulin-stat').css('opacity', 1);
		} else {
			$('#insulin-stat').css('opacity', 0.3);
		}
	});

	$('#timelineContainer').scroll(function() {
		var average = stat.average(timeline.scrollTicks(), timeline.scrollTicks()+oneDay);

		if(average) {
			$('#averageData').text(average);
			aw.update(parseInt(average));
			$('#bg-stat').css('opacity', 1);
		} else {
			$('#bg-stat').css('opacity', 0.3);
		}
		
		var range = stat.range(timeline.scrollTicks(), timeline.scrollTicks()+oneDay);
		$('#rangeData').text();
		
		if(range) {
			$('#rangeData').text(range  + '%');
			var values = [100-range, range];
				if(range == 100) {
					values = [1, 99];
				}
    var labels = ['', ''],
    colors = ['white', '#84C5D9'],
    bcolors = ['white', '#84C5D9'];

    $("#range-widget").children().remove()
  var rangePie = Raphael("range-widget", 54, 54).pieChart(27, 27, 25, values, labels, colors, bcolors, "#B6C6CF");

			$('#range-stat').css('opacity', 1);
		} else {
			$('#range-stat').css('opacity', 0.3);
		}

		var insulinStats = stat.insulinRatio(timeline.scrollTicks(), timeline.scrollTicks()+oneDay);

		if(insulinStats && insulinStats.basalPercent > 0) {
			$('#insulinData').text(insulinStats.bolusPercent + '%:' + insulinStats.basalPercent + '%');
		
		var values = [insulinStats.bolusPercent, insulinStats.basalPercent],
      labels = [insulinStats.bolus, insulinStats.basal],
      colors = ['white', '#009AA3'],
      bcolors = ['#009AA3', '#87F4EF'];

		
			$("#bolus-widget").children().remove()
  		var rangePie = Raphael("bolus-widget", 54, 54).pieChart(27, 27, 25, values, labels, colors, bcolors, "#B6C6CF");

			$('#insulin-stat').css('opacity', 1);
		} else {
			$('#insulin-stat').css('opacity', 0.3);
		}
	});
});
</script>
	</head>
	<body>
		<div id="load">
			<div id='logocontainer'>
    	<div class="logo">
        <img src="/img/blip.png" alt="" class="frame" />
        <img src="/img/ani-bg.png" alt="" class="ani-bg" />
      </div>
      </div>
    </div>
		<div id='content'>
			<header>	
				<div class='inner'>
					<div class='currentPatient'>
						<img src='/img/electra.png'>
						<h1>Electra White</h1>
					</div>
					<div class='container'>
						<h1 class='logo'><img src='/img/logo.png'></h1>
						<div class='user'>
							<div class='text'>Logged in as <span id='username'>Tamara White</span></div><img src='/img/tamar.jpg'><img id='more' src='/img/more.png'><div class='clear'></div>
						</div>
						<div class='clear'></div>
					</div>
				</div>
			<div class='patient'>
				<div class='inner'>
					<div class='holder'>
						<div class='info'>
							<div id='minihistory'>13 years old. Diagnosed 3 years ago.</div>
							<p>Electra loves to travel and to draw on her sketch book. Her favorite colors are orange and blue.</p>
						</div>
						<div class='hba1c'>
							<h3>Hba1c</h3>
							<div id='hba1c-image'></div>
							<div id='hba1c-stats'>
								<div class='percent'></div>
								<div class='ago'></div>
							</div>
							<div class='clear'></div>
						</div>
						<div class='box'>
							<div id='bounds'>
							<div id='devices'>

								<div class='title'><h3>DEVICES</h3> <img class='settings' src='/img/settings.png'><div class='clear'></div></div>
								<ul>
									<li>
										<img id='pump' src='/img/pump.png'> &nbsp; Animas Pump
									</li>
									<li>
										<img id='bg' src='/img/bg.png'> One Touch Ultra
									</li>
								</ul>
							</div>
							<div id='team'>
								<div class='title'><h3>TEAM</h3> <img class='settings'  src='/img/settings.png'><div class='clear'></div></div>
								<ul>
									<li>
										<img src='/img/tamar.jpg'>
									</li>
									<li>
										<img src='/img/ali.png'>
									</li>
									<li>
										<img src='/img/steven.png'>
									</li>
									<li>
										<img src='/img/tine.jpg'>
									</li>
									<li>
										<img id='next' src='/img/next.png'>
									</li>
									<div class='clear'></div>
								</ul>
							</div>
							<div class='clear'></div>
							</div>
							
						</div>
						<div class='clear'></div>
					</div>		
				</div>
				<div id='cover'><div class='handel'><img src='/img/handel.png'></div></div>
				</div>
			</header>
			<div class='inner' id='main'>
				<div class='container'>
				<div id='graph'>
					<div id='nav'>
						<ul>
							<li class='arrow arrowup'><img id='up' img src='/img/up.png'></li>
							<li class='today'>today</li>
							<li class='arrow arrowdown'><img id='down' img src='/img/down.png'></li>
						</ul>
						<ul class='period'>
							<li id='one'>1 day</li>
							<li id='week'>1 weeks</li>
							<li id='two'>2 weeks</li>
						</ul>
						<style>
						.communication {
							float: right;
						}
						#messages {
							background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAAAuCAYAAAD6FPHbAAAFW0lEQVR4Xu2cW2gcVRjHz5lNa9raeiteEKWtL6IPKg0iFdLMGrNbRSrZ3QHx+lwqKig+KRWRoii+aakoQh+EzMZYAmZna2a3pYh4wYeK8UF86YPVjTTdmiZtkjn+z7jZbJLJ7pyZbDNhvg1hZ898Z853/vPbb851OaMXKaCgAFewJVNSgBEwBIGSAgSMklxkTMAQA0oKEDBKcpExAUMMKClAwCjJRcarAowQQhs8Uf6WCXY34+IC3qcY47dC3opw2Bausc11qYW4yDjfWvv8J95vc4+FOId0mQfZxSRnfMt8Hlx/kvOFz/+bswnO2fURu4XS58RSnxyHC00T3lqjcqj3snOOFLUhHR8v4qOoaTWOPNuX1V0Iz/TaxT/MpPS3wuq1KsCYxfI7XIhX4EwnKuZWCpVD0sJxw80X8lwNDKhYO4ZtPb3heKmd13XCirBa+eG243Ut1BFCeAOD2rvILMuHdPzV06GN1qruUu95DT38uKBp2p7+R/eOhanv6gBTsC/D0Q2SkzDOUN62KiBxHszt03NhSgl9g03LPoBvwmEAsy2MI5S3/QrgMTfNnI47jce6K0FLCw9Mwa4AlpsougS9BVcxnxCXHMY/M9L6i0FLDQVMvmAbaIJ8isKvDeoA5bu6Csh2Tjald+BL7tneauVNWGB+BzC7KLq0kjk659GSnkZT891cSj8UxKvAwJhF+xEmtAE05m8MUjDlWTMFZJC5lEsnAz0VggNj2T+gu7ibosua3fgQBYsqvuyvZtM9n6heJBAwA8XS/dwRZTwHr1MtkOwjoYAc+/k7l9bdgVKVVyBgzBH7ONf4ExRdVKSOlq0cPcdA3rOZvp4hFc+UgfnKOnnHDJsbaxy6VymQbCOjANq/YiybTt6r4pEyMPmR0udMY89RdFGROaq2YoKzxP5Mau8pvx4qATM8/OPm6Q1VTPq50wD0Wv8KyNmn73Lpnj1+q6IETN4qHcaFX8L/Jr8FkF20FcBzaUIkOh42ert/9eOpEjCmVbqCDB30OPIj7bqxweoC8WU2lcz68dg3MKZVxvyDeBsZqCvtR9l1ZIMoM7Ux4ezc39v7Vyu3fQODeaN/MA1wA0WXVpKuy/Ny9PcjjP4ebOW9L2DyxfJTzBFHsdol0HByKyfo/NorIBd/ier4RsMw5pp54wsYtF3+gOEOii5rf2Pb6MEUoHkfUebNUMCYxdE+5vAv0JWmScY23q0IXFouI53OpZIL6689nGoZYdB2+QltlwcoukTglrbZBQBTxcLh1zKp5NGVimoKzIBl74bBN5gGiNrq/DZLF9vLyy52BV3sWwIBky+UhtHQfZyiS3wAAjGT2OPwPOaYBr1qvWKEGRop7Zjl7Ay2QVDPKD68yJrK7S2/ZdP6PUrA5K3RY4xpT1N0iRctLjFCTCQ09mR/X/Lk0tp7Rpjjp09vnfn3SgWN3WviJxfV2GWGie/RY3rIFzB5y34Pm+4OgiaaZIwpPyDmfIKz7v6U/kujBJ4RxizYs7WtmS273THVMw7VltMFQxjIyzQFxiyUXkbP6BBNMsaBieZ1xNbaKdHJdhm6fm7eclkEQVf6PICRM9IUXYgZMCOOGKnkAU9g8sXSM7D4mLrSRMq8Angsze3cvm1TV1fXjExbFEWwou4s0m6n6ELA1BXgXE5KfoCdkm8sAgYLpPYx5hzDNIDcWE8vUmAhyDB2GcC4PeZ6hMHPdvysMX4fhoap7UKwLFIAEaaKQPI6Rn+PuHAMFE49yNnsCfqNFyJlBQXkT4mNI8rc7AKDtsvXeEtT24WAWUkBd6ck5y/wodHRu+ZmtTMw7CS5SIEmwMjfIzz7H6MFuLo0lPp+AAAAAElFTkSuQmCC);
							
							width: 110px;
						}
						#messages > div {
							font-weight: lighter;
							color: white;
							padding-left: 22px;
							margin-top: 5px;
							font-size: 14px;
						}
						#messagetopbar {
							width: 0px;
							height: 5px;
							float: right;
							background: #ACB9BF;
							margin-top: 41px;
							position: absolute;
							display: none;
							margin-left: 1088px;	
						}
						
						</style>
						<div id='messagetopbar'></div>
						<ul class='communication'>
							<li id='messages'><div>Messages</div></li>
						</ul>
						<div class='clear'></div>
					</div>

					<div id='chart'>
						<div id='chartTop'></div>
						<div id='chartMain'></div>
						<div id='chartBottom'></div>
					</div>
					
					<style>
						#messageThread {
							position: absolute;
							margin-left: 1090px;
							background: white;
							border-left: 1px solid #DCE4E8;
							border-right: 1px solid #DCE4E8; 
							width: 0px;
							height: 694px;
							display: none;
							z-index: 1;
						}
						</style>
						<script>
						$(function() {
							var showMessages = false;

							$('#messages').click(function() {


								if(showMessages) {
									//$('#messageThread').animate({height:'0px'}, 500);
									
									$('#messageThread').animate({'margin-left': '1088px', width:'0px'}, 500, function() {
										$('#messageThread').hide(0);
									});

									$('#messagetopbar').animate({'margin-left': '1088px', width:'0px'}, 500, function() {
										$('#messagetopbar').hide(0);
									});

									$('#messages').animate({'margin-right': '0px'}, 350);
									$('#timelineContainer').animate({width:'1041px'}, 500);
								} else {
									//$('#messageThread').animate({height:'694px'}, 500);
									$('#messageThread').show(0);
									$('#messageThread').animate({'margin-left': '788px', width:'300px'}, 500);

									$('#messagetopbar').show(0);
									$('#messagetopbar').animate({'margin-left': '790px', width:'300px'}, 500);

									setTimeout(function() {
										$('#messages').animate({'margin-right': '163px'}, 300);	
									}, 150);
									

									$('#timelineContainer').animate({width:'740px'}, 500);
									
								}

								showMessages = !showMessages;								
							});
						});
						</script>
						<div id='messageThread'>
							<style>
									.thread img {
			width: 45px;
			float: left;
		}
		.thread h3 {
			padding-left: 10px;
			display: inline-block;
			float: none;
			font-weight: bold;
			color: orange;
			width: 100px;
		}
		.thread .text {
			padding-top: 10px;
			color: #5D5D5D;
			font-size: 15px;
			font-weight: lighter;
			line-height: 17px;
		}
		.thread > li {
			width: 275px;
			padding: 15px 15px 15px 10px;	
			border-bottom: 2px solid #DCE4E8; 
		}
		.thread .timestamp {
			padding-left: 10px;
			color: #636363;
			display: inline-block;
			font-weight: lighter;
			font-size: 13px;
		}
		.thread {
			overflow: scroll;
			height: 694px;
		}
		.subcomment >li {
			padding-top: 15px;	
		}
		.subcomment {
			padding-top: 15px;	
		}
		.subcomment img {
			width: 35px;
			padding-left: 5px;

			float: left;
		}
		.subcomment h3 {
			padding-left: 15px;
			display: inline-block;
			float: none;
		}

		.subcomment .text {
			padding-top: 10px;
			padding-left: 55px;
		}
		.subcomment .timestamp {
			padding-left: 15px;
			display: inline-block;
		}
		</style>
			<ul class='thread'>
				<li>
					<img src='/img/tamar.jpg'>
					<h3>Elon Musk</h3>
					<div class='timestamp'>2 months ago at 8 pm</div>
					<div class='clear'></div>
					<div class='text'>Chief executive officer of SpaceX and founder of PayPal, addressed a National Press Club luncheon on September 29, 2011</div>
					<ul class='subcomment'>
						<li>
							<img src='/img/tamar.jpg'>
							<h3>Elon Musk</h3>
							<div class='timestamp'>2 months ago at 8 pm</div>
							<div class='clear'></div>
							<div class='text'>Chief executive officer of SpaceX and founder of PayPal, addressed a National Press Club luncheon on September 29, 2011</div>
						</li>
					</ul>
				</li>
				<li>
					<img src='/img/tamar.jpg'>
					<h3>Elon Musk</h3>
					<div class='timestamp'>2 months ago at 8 pm</div>
					<div class='clear'></div>
					<div class='text'>Chief executive officer of SpaceX and founder of PayPal, addressed a National Press Club luncheon on September 29, 2011</div>
				</li>
				<li>
					<img src='/img/tamar.jpg'>
					<h3>Elon Musk</h3>
					<div class='timestamp'>2 months ago at 8 pm</div>
					<div class='clear'></div>
					<div class='text'>Chief executive officer of SpaceX and founder of PayPal, addressed a National Press Club luncheon on September 29, 2011</div>
				</li>
				<li>
					<img src='/img/tamar.jpg'>
					<h3>Elon Musk</h3>
					<div class='timestamp'>2 months ago at 8 pm</div>
					<div class='clear'></div>
					<div class='text'>Chief executive officer of SpaceX and founder of PayPal, addressed a National Press Club luncheon on September 29, 2011</div>
				</li>
			</ul>
						</div>
					<div id='timelineHolder'>
						
						<div id='timelineAxis'></div>
						<div id='timelineContainer'>
							<div id='timeline'></div>
						</div>

						<div class='clear'></div>
						
						
					</div>

					<div id='stats'>
						<ul>
							<li class='bolusli' id='insulin-stat'>
								<div class='stat'>
									<div class='infoIcon' id='bolus-widget'></div>
									<h2>Bolus: Basal</h2>
									<div id='insulinData' class='data'>48% : 52% <span class='small'>0.8 u/kilo</span></div>
								</div>

							</li>
							<li class='range' id='range-stat'>
								<div class='stat'>
									<div class='infoIcon' id='range-widget'></div>
									<h2>Time in range</h2>
									<div id='rangeData' class='data'>%</div>
								</div>
							</li>
							<li id='bg-stat'>
								<div class='stat'>
									<div class='infoIcon' id='average-widget'></div>
									<h2>Average Bg</h2>
									<div class='data' id='averageData'></div>
								</div>
							</li>
						</ul>
						<div class='clear'></div>
					</div>
				</div>
				</div>
			</div>
		</div>
	</body>
</html>